# 匯出功能規格

## 新增的需求

### 需求：匯出轉換結果
應支援將轉換結果匯出為多種格式供後續使用。

#### 情境：匯出為文字檔
- **當** 使用者點擊「匯出」→「純文字 (.txt)」
- **則** 應將轉換結果匯出為 TXT 檔案
- **且** 檔名格式：`prompt-result-YYYY-MM-DD-HHMMSS.txt`
- **且** 應使用 UTF-8 編碼
- **且** 應自動下載檔案

#### 情境：匯出為 Markdown
- **當** 使用者點擊「匯出」→「Markdown (.md)」
- **則** 應將轉換結果匯出為 Markdown 檔案
- **且** 應保留 Markdown 格式
- **且** 應包含元資料標題：
  - 原始輸入
  - 轉換時間
  - 使用的範本
- **且** 檔名格式：`prompt-result-YYYY-MM-DD-HHMMSS.md`

#### 情境：匯出為 PDF
- **當** 使用者點擊「匯出」→「PDF (.pdf)」
- **則** 應將轉換結果轉換為 PDF
- **且** 應使用清晰的字體和格式
- **且** 應包含頁首頁尾：
  - 標題：「Prompt 轉換結果」
  - 日期時間
  - 頁碼
- **且** 應支援程式碼區塊高亮（如果有）
- **且** 使用瀏覽器列印功能或 PDF 庫生成

### 需求：批量匯出
應支援一次匯出多個轉換結果。

#### 情境：匯出選定的歷史記錄
- **當** 使用者在歷史面板選擇多筆記錄並點擊「批量匯出」
- **則** 應顯示匯出選項對話框
- **且** 應提供格式選擇：
  - 單一檔案（合併所有結果）
  - 多個檔案（每筆記錄一個檔案，ZIP 壓縮）
  - Excel 試算表（CSV 格式）
- **且** 應提供欄位選擇（包含/排除元資料）
- **且** 確認後應開始匯出

#### 情境：匯出為 ZIP 壓縮檔
- **當** 選擇「多個檔案」選項時
- **則** 應為每筆記錄生成單獨檔案
- **且** 檔名應包含時間戳記和序號
- **且** 應打包為 ZIP 檔案
- **且** ZIP 檔名：`prompt-results-batch-YYYY-MM-DD.zip`
- **且** 應顯示打包進度

### 需求：匯出範本
應支援匯出自訂範本供分享或備份。

#### 情境：匯出單個範本
- **當** 使用者點擊範本的「匯出」按鈕
- **則** 應將範本匯出為 JSON 檔案
- **且** 檔名：`template-{template-name}.json`
- **且** 應包含完整範本資料：
  - 名稱、描述、類別
  - 範本內容
  - 變數定義
  - 元資料（建立時間、版本等）

#### 情境：匯出所有自訂範本
- **當** 使用者點擊「匯出所有範本」
- **則** 應將所有自訂範本打包匯出
- **且** 檔案格式：JSON（範本陣列）
- **且** 檔名：`templates-export-YYYY-MM-DD.json`
- **且** 不包含預設範本（已內建）

### 需求：匯出配置
應支援匯出應用配置供備份或遷移。

#### 情境：匯出完整配置
- **當** 使用者點擊「設定」→「匯出配置」
- **則** 應匯出 JSON 檔案包含：
  - API keys（加密）
  - 使用者偏好設定
  - 自訂範本
  - 收藏的歷史記錄
  - 標籤定義
- **且** 檔名：`prompt-to-context-config-YYYY-MM-DD.json`
- **且** 應提示選擇是否包含敏感資訊（API keys）

#### 情境：匯入配置
- **當** 使用者點擊「設定」→「匯入配置」並選擇檔案
- **則** 應驗證配置檔案格式
- **且** 應顯示匯入預覽：
  - 將匯入的項目清單
  - 衝突項目標記
- **且** 應提供選項選擇性匯入（勾選框）
- **且** 確認後應套用配置

### 需求：匯出為程式碼片段
應支援將轉換結果匯出為不同程式語言的字串。

#### 情境：匯出為 JavaScript
- **當** 使用者點擊「匯出」→「程式碼」→「JavaScript」
- **則** 應生成 JavaScript 程式碼片段：
  ```javascript
  const prompt = `轉換結果內容...`;
  ```
- **且** 應正確處理跳脫字元
- **且** 應使用範本字串（backticks）
- **且** 應複製到剪貼簿並顯示提示

#### 情境：匯出為 Python
- **當** 使用者點擊「匯出」→「程式碼」→「Python」
- **則** 應生成 Python 程式碼片段：
  ```python
  prompt = """轉換結果內容..."""
  ```
- **且** 應使用三引號字串
- **且** 應正確處理跳脫字元

#### 情境：匯出為其他語言
- **當** 使用者選擇其他程式語言（Java, C#, Go, Rust 等）
- **則** 應生成對應語言的字串格式
- **且** 應使用該語言的字串語法
- **且** 應正確處理跳脫

### 需求：匯出統計報告
應支援匯出使用統計報告。

#### 情境：生成統計報告
- **當** 使用者點擊「統計」→「匯出報告」
- **則** 應生成 HTML 或 PDF 報告
- **且** 報告應包含：
  - 概覽（總轉換次數、成功率等）
  - 圖表（趨勢圖、分佈圖）
  - 熱門範本排行
  - 時間分析
  - 錯誤分析
- **且** 應使用專業的報告範本
- **且** 應可選擇時間範圍

#### 情境：匯出為 Excel
- **當** 選擇匯出為 Excel 格式時
- **則** 應生成 CSV 檔案（Excel 可開啟）
- **且** 應包含多個工作表：
  - 概覽統計
  - 詳細記錄
  - 範本使用統計
  - 錯誤日誌
- **且** 應正確格式化數字和日期

### 需求：匯出選項和設定
應提供豐富的匯出選項自訂。

#### 情境：自訂匯出選項
- **當** 使用者開啟匯出對話框時
- **則** 應提供選項：
  - **包含元資料**：時間、範本、執行時間等
  - **格式化**：保留格式 vs 純文字
  - **編碼**：UTF-8 vs 其他
  - **換行符**：LF vs CRLF vs CR
  - **檔名模板**：自訂檔名格式
- **且** 應儲存使用者偏好（下次使用）
- **且** 應提供「重設為預設」按鈕

#### 情境：預覽匯出結果
- **當** 使用者選擇匯出選項時
- **則** 應即時預覽匯出結果
- **且** 應顯示檔案大小估算
- **且** 應顯示將包含的項目數量
- **且** 大檔案時應顯示警告

### 需求：分享功能
應支援快速分享轉換結果。

#### 情境：生成分享連結
- **當** 使用者點擊「分享」按鈕
- **則** 應生成包含轉換結果的 URL
- **且** URL 應使用 Base64 編碼（或短網址服務）
- **且** 應提供複製連結按鈕
- **且** 應提供 QR Code 生成（可選）
- **且** URL 格式：`https://yourapp.com/#share=<encoded_data>`

#### 情境：從分享連結載入
- **當** 使用者開啟分享連結
- **則** 應解析並顯示轉換結果
- **且** 應提供「重新轉換」按鈕
- **且** 應提供「儲存到歷史」按鈕
- **且** 應顯示「這是分享的內容」提示

### 需求：自動儲存和匯出
應提供自動匯出功能。

#### 情境：自動匯出到檔案
- **當** 啟用「自動匯出」設定時
- **則** 每次轉換成功後應自動匯出
- **且** 應可配置匯出格式和位置
- **且** 應可配置檔名模板
- **且** 失敗時應記錄錯誤但不中斷

#### 情境：定期備份
- **當** 啟用「定期備份」時
- **則** 應按設定的間隔自動備份
- **且** 應可配置備份內容（歷史、範本、配置）
- **且** 應可配置保留份數
- **且** 應在背景執行不影響使用

### 需求：匯出品質控制
應確保匯出的內容品質。

#### 情境：驗證匯出內容
- **當** 匯出操作完成時
- **則** 應驗證檔案是否成功生成
- **且** 應檢查檔案大小是否合理
- **且** 應檢查內容是否完整
- **且** 失敗時應提供錯誤訊息和重試選項

#### 情境：匯出錯誤處理
- **當** 匯出過程中發生錯誤
- **則** 應顯示友善的錯誤訊息
- **且** 應說明可能的原因：
  - 瀏覽器權限不足
  - 儲存空間不足
  - 檔案名稱無效
- **且** 應提供解決建議
- **且** 應記錄錯誤到日誌

### 需求：跨平台相容性
匯出功能應在不同平台正常工作。

#### 情境：桌面瀏覽器匯出
- **當** 在桌面瀏覽器執行匯出時
- **則** 應使用 `download` attribute 或 Blob API
- **且** 應尊重瀏覽器的下載設定
- **且** 應在下載完成後顯示提示

#### 情境：行動裝置匯出
- **當** 在行動裝置執行匯出時
- **則** 應適配行動裝置的檔案系統
- **且** 應提供「分享」選項（系統分享表單）
- **且** 應支援儲存到雲端（Google Drive, iCloud 等）
- **且** 應處理行動瀏覽器的限制

### 需求：匯出範本客製化
應允許使用者自訂匯出範本。

#### 情境：建立匯出範本
- **當** 使用者開啟「匯出範本編輯器」
- **則** 應提供範本編輯介面
- **且** 應支援變數插入：
  - `{{content}}` - 轉換結果
  - `{{originalInput}}` - 原始輸入
  - `{{timestamp}}` - 時間戳記
  - `{{template}}` - 使用的範本名稱
- **且** 應提供預覽功能
- **且** 應可儲存多個自訂範本

#### 情境：使用自訂匯出範本
- **當** 匯出時選擇自訂範本
- **則** 應使用該範本格式化內容
- **且** 應替換所有變數
- **且** 應保留範本的格式和結構

### 需求：批量操作優化
大量匯出時應優化效能。

#### 情境：匯出大量記錄
- **當** 匯出超過 100 筆記錄時
- **則** 應顯示進度條
- **且** 應分批處理（例如每批 50 筆）
- **且** 應使用 Web Worker 避免阻塞 UI
- **且** 應允許取消操作
- **且** 應估算剩餘時間

#### 情境：取消匯出操作
- **當** 使用者點擊「取消」按鈕
- **則** 應停止匯出程序
- **且** 應清理已生成的臨時檔案
- **且** 應顯示「已取消」訊息
- **且** 已完成的部分應可選擇保留

### 需求：匯出格式擴展
應支援未來擴展更多匯出格式。

#### 情境：註冊新匯出格式
- **當** 開發者想新增匯出格式時
- **則** 應提供 Plugin API 註冊新格式
- **且** 應定義格式處理函數
- **且** 應在匯出選單中自動顯示
- **且** 應支援格式特定選項

### 需求：雲端儲存整合（進階功能）
應支援直接匯出到雲端服務。

#### 情境：匯出到 Google Drive
- **當** 使用者選擇「匯出到 Google Drive」
- **則** 應開啟 Google OAuth 授權
- **且** 授權後應上傳檔案到 Drive
- **且** 應允許選擇資料夾
- **且** 應顯示上傳進度
- **且** 成功後應提供檢視連結

#### 情境：匯出到 Dropbox
- **當** 使用者選擇「匯出到 Dropbox」
- **則** 應使用 Dropbox API 上傳
- **且** 應處理授權和檔案上傳
- **且** 應支援大檔案分片上傳

### 需求：匯出記錄
應記錄所有匯出操作。

#### 情境：記錄匯出歷史
- **當** 執行匯出操作時
- **則** 應記錄到匯出日誌
- **且** 應包含：
  - 匯出時間
  - 匯出格式
  - 匯出項目數量
  - 檔案大小
  - 成功/失敗狀態
- **且** 應可在「匯出歷史」查看

#### 情境：檢視匯出歷史
- **當** 使用者開啟「匯出歷史」面板
- **則** 應列出所有匯出記錄
- **且** 應顯示每次匯出的詳情
- **且** 成功的匯出應提供「重新下載」選項（如果可能）
- **且** 失敗的匯出應顯示錯誤原因
